<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rugby Tactics MVP</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }
    #field {
      width: 100vw;
      height: 100vh;
      background: url('H.png') center/cover no-repeat;
      position: relative;
      overflow: hidden;
    }
    .player, .ball {
      position: absolute;
      width: 40px;
      height: 40px;
      background-color: #007bff;
      border-radius: 50%;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.5s ease;
    }
    .ball {
      font-size: 24px;
      background-color: transparent;
    }
    .tackled {
      background-color: red !important;
    }
    .controls {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(255, 255, 255, 0.8);
      padding: 10px;
      border-radius: 8px;
    }
    .controls button {
      margin: 2px;
    }
  </style>
</head>
<body>
  <div class="controls">
    <button onclick="addPlayer('attacker')">Add Attacker</button>
    <button onclick="addPlayer('defender')">Add Defender</button>
    <button onclick="addBall()">Add Ball</button>
    <button onclick="saveStep()">Save Step</button>
    <button onclick="undoStep()">Undo</button>
    <button onclick="resetField()">Reset</button>
    <button onclick="playSteps()">Play</button>
    <button onclick="pauseSteps()">Pause</button>
  </div>
  <div id="field"></div>

  <script>
    const field = document.getElementById('field');
    let dragged = null;
    let offsetX, offsetY;
    let playerCount = 0;
    let ballExists = false;
    let steps = [];
    let currentStep = 0;
    let isPlaying = false;
    let playInterval;

    field.addEventListener('mousedown', e => {
      if (e.target.classList.contains('player') || e.target.classList.contains('ball')) {
        dragged = e.target;
        const rect = dragged.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;
      }
    });

    field.addEventListener('mousemove', e => {
      if (dragged) {
        dragged.style.left = `${e.clientX - offsetX}px`;
        dragged.style.top = `${e.clientY - offsetY}px`;
        checkTackles();
      }
    });

    field.addEventListener('mouseup', () => {
      dragged = null;
    });

    function addPlayer(type) {
      if (document.querySelectorAll(`.${type}`).length >= 15) return;
      const div = document.createElement('div');
      div.className = `player ${type}`;
      div.innerText = ++playerCount;
      div.style.left = `${window.innerWidth / 2 - 20}px`;
      div.style.top = `${window.innerHeight / 2 - 20}px`;
      field.appendChild(div);
    }

    function addBall() {
      if (ballExists) return;
      const ball = document.createElement('div');
      ball.className = 'ball';
      ball.innerText = '🏉';
      ball.style.left = `${window.innerWidth / 2 - 20}px`;
      ball.style.top = `${window.innerHeight / 2 - 20}px`;
      field.appendChild(ball);
      ballExists = true;
    }

    function saveStep() {
      const snapshot = [];
      document.querySelectorAll('.player, .ball').forEach(el => {
        snapshot.push({
          id: el.innerText || 'ball',
          class: el.className,
          left: el.style.left,
          top: el.style.top
        });
      });
      steps.push(snapshot);
    }

    function undoStep() {
      steps.pop();
    }

    function resetField() {
      field.innerHTML = '';
      playerCount = 0;
      ballExists = false;
      steps = [];
    }

    function playSteps() {
      if (isPlaying || steps.length === 0) return;
      isPlaying = true;
      currentStep = 0;

      playInterval = setInterval(() => {
        if (currentStep >= steps.length) {
          clearInterval(playInterval);
          isPlaying = false;
          return;
        }

        const snapshot = steps[currentStep];
        snapshot.forEach(data => {
          let el = Array.from(document.querySelectorAll('.player, .ball')).find(e => (e.innerText || 'ball') === data.id);
          if (el) {
            el.style.left = data.left;
            el.style.top = data.top;
          }
        });
        currentStep++;
        checkTackles();
      }, 1000);
    }

    function pauseSteps() {
      clearInterval(playInterval);
      isPlaying = false;
    }

    function checkTackles() {
      const attackers = document.querySelectorAll('.attacker');
      const defenders = document.querySelectorAll('.defender');

      attackers.forEach(attacker => {
        const aRect = attacker.getBoundingClientRect();
        defenders.forEach(defender => {
          const dRect = defender.getBoundingClientRect();
          const dx = aRect.left - dRect.left;
          const dy = aRect.top - dRect.top;
          const distance = Math.sqrt(dx * dx + dy * dy);
          if (distance < 50) {
            attacker.classList.add('tackled');
          } else {
            attacker.classList.remove('tackled');
          }
        });
      });
    }
  </script>
</body>
</html>
