<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rugby Coaching Tool</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }
    #field {
      position: relative;
      width: 100vw;
      height: 90vh;
      background: url('H.png') center/cover no-repeat;
      border: 2px solid #333;
      overflow: hidden;
    }
    .player, .ball {
      position: absolute;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      text-align: center;
      line-height: 30px;
      font-size: 14px;
      font-weight: bold;
      color: #fff;
      transition: all 0.4s ease-in-out;
    }
    .attacker {
      background: blue;
    }
    .defender {
      background: yellow;
    }
    .ball {
      background: brown;
      width: 20px;
      height: 20px;
      line-height: 20px;
    }
    .tackled {
      background: red !important;
    }
    #controls {
      margin: 10px;
    }
    button {
      margin-right: 10px;
      padding: 6px 10px;
    }
  </style>
</head>
<body>

<div id="controls">
  <button onclick="addPlayer('attacker')">Add Attacker</button>
  <button onclick="addPlayer('defender')">Add Defender</button>
  <button onclick="addBall()">Add Ball</button>
  <button onclick="saveStep()">Save Step</button>
  <button onclick="undoStep()">Undo</button>
  <button onclick="resetField()">Reset</button>
</div>

<div id="field"></div>

<script>
  const field = document.getElementById('field');
  let selectedElement = null;
  let offsetX = 0;
  let offsetY = 0;
  let steps = [];

  function addPlayer(type) {
    const player = document.createElement('div');
    const number = document.querySelectorAll(`.${type}`).length + 1;
    player.className = `player ${type}`;
    player.textContent = number;
    player.style.left = `calc(50% - 15px)`;
    player.style.top = `calc(50% - 15px)`;
    field.appendChild(player);
    makeDraggable(player);
  }

  function addBall() {
    if (document.querySelector('.ball')) return;
    const ball = document.createElement('div');
    ball.className = 'ball';
    ball.textContent = '';
    ball.style.left = `calc(50% - 10px)`;
    ball.style.top = `calc(50% - 10px)`;
    field.appendChild(ball);
    makeDraggable(ball);
  }

  function makeDraggable(element) {
    element.addEventListener('mousedown', (e) => {
      selectedElement = element;
      const rect = element.getBoundingClientRect();
      offsetX = e.clientX - rect.left;
      offsetY = e.clientY - rect.top;
    });
  }

  document.addEventListener('mouseup', () => {
    selectedElement = null;
  });

  document.addEventListener('mousemove', (e) => {
    if (selectedElement) {
      const fieldRect = field.getBoundingClientRect();
      const x = e.clientX - fieldRect.left - offsetX;
      const y = e.clientY - fieldRect.top - offsetY;

      selectedElement.style.left = `${x}px`;
      selectedElement.style.top = `${y}px`;

      // Tackle logic: defenders near attackers
      if (selectedElement.classList.contains('defender')) {
        document.querySelectorAll('.attacker').forEach(attacker => {
          const dx = attacker.offsetLeft - selectedElement.offsetLeft;
          const dy = attacker.offsetTop - selectedElement.offsetTop;
          const distance = Math.sqrt(dx * dx + dy * dy);
          if (distance < 40) {
            attacker.classList.add('tackled');
          } else {
            attacker.classList.remove('tackled');
          }
        });
      }
    }
  });

  function saveStep() {
    const positions = [];
    document.querySelectorAll('.player, .ball').forEach(el => {
      positions.push({
        class: el.className,
        text: el.textContent,
        left: el.style.left,
        top: el.style.top
      });
    });
    steps.push(positions);
  }

  function undoStep() {
    if (steps.length === 0) return;
    const lastStep = steps.pop();
    document.querySelectorAll('.player, .ball').forEach(el => el.remove());
    lastStep.forEach(data => {
      const el = document.createElement('div');
      el.className = data.class;
      el.textContent = data.text;
      el.style.left = data.left;
      el.style.top = data.top;
      field.appendChild(el);
      makeDraggable(el);
    });
  }

  function resetField() {
    steps = [];
    document.querySelectorAll('.player, .ball').forEach(el => el.remove());
  }
</script>

</body>
</html>
