<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rugby Play Simulator MVP</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }
    #field {
      width: 100vw;
      height: 100vh;
      background: url('H.png') no-repeat center center;
      background-size: cover;
      position: relative;
    }
    .player, .defender, .ball {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: grab;
      user-select: none;
      /* Smooth animation for movement */
      transition: left 0.3s ease, top 0.3s ease;
    }
    .player {
      background: blue;
      color: white;
    }
    .defender {
      background: red;
      color: white;
    }
    .ball {
      background: none;
      font-size: 24px;
      cursor: grab;
    }
    .controls {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255,255,255,0.8);
      padding: 10px;
      border-radius: 8px;
      z-index: 10;
    }
    button {
      margin: 2px;
    }
    .tackle {
      border: 3px solid yellow;
    }
  </style>
</head>
<body>
  <div id="field">
    <div class="controls">
      <button onclick="addPlayer()">Add Attacker</button>
      <button onclick="addDefender()">Add Defender</button>
      <button onclick="addBall()">Add Ball</button>
      <button onclick="saveStep()">Save Step</button>
      <button onclick="resetSteps()">Reset</button>
      <button onclick="undoStep()">Undo</button>
      <button onclick="playAnimation()">Play</button>
      <button onclick="pauseAnimation()">Pause</button>
    </div>
  </div>

  <script>
    const field = document.getElementById("field");
    let attackers = 0;
    let defenders = 0;
    let ballExists = false;
    const maxPlayers = 15;
    const steps = [];
    let animationInterval;
    let currentStep = 0;

    function addPlayer() {
      if (attackers >= maxPlayers) return;
      const player = document.createElement("div");
      player.className = "player";
      player.textContent = attackers + 1;
      player.style.left = "200px";
      player.style.top = "200px";
      makeDraggable(player);
      field.appendChild(player);
      attackers++;
    }

    function addDefender() {
      if (defenders >= maxPlayers) return;
      const defender = document.createElement("div");
      defender.className = "defender";
      defender.textContent = defenders + 1;
      defender.style.left = "400px";
      defender.style.top = "200px";
      makeDraggable(defender);
      field.appendChild(defender);
      defenders++;
    }

    function addBall() {
      if (ballExists) return;
      const ball = document.createElement("div");
      ball.className = "ball";
      ball.innerHTML = "🏉";
      ball.style.left = "300px";
      ball.style.top = "200px";
      makeDraggable(ball);
      field.appendChild(ball);
      ballExists = true;
    }

    function makeDraggable(element) {
      let offsetX, offsetY, isDragging = false;

      element.addEventListener("mousedown", (e) => {
        offsetX = e.offsetX;
        offsetY = e.offsetY;
        isDragging = true;
        element.style.cursor = "grabbing";
      });

      document.addEventListener("mousemove", (e) => {
        if (isDragging) {
          element.style.left = `${e.clientX - offsetX}px`;
          element.style.top = `${e.clientY - offsetY}px`;
        }
      });

      document.addEventListener("mouseup", () => {
        if (isDragging) {
          isDragging = false;
          element.style.cursor = "grab";
        }
      });

      element.addEventListener("dblclick", () => {
        if (element.classList.contains("defender")) {
          element.classList.toggle("tackle");
        }
      });
    }

    function saveStep() {
      const currentPositions = [...field.children].filter(el => el.classList.contains("player") || el.classList.contains("defender") || el.classList.contains("ball")
        ).map(el => ({
          class: el.className,
          text: el.textContent,
          html: el.innerHTML,
          left: el.style.left,
          top: el.style.top,
          tackle: el.classList.contains("tackle")
        }));
      steps.push(currentPositions);
    }

    function resetSteps() {
      steps.length = 0;
    }

    function undoStep() {
      steps.pop();
    }

    function playAnimation() {
      if (steps.length === 0) return;
      currentStep = 0;
      clearInterval(animationInterval);
      animationInterval = setInterval(() => {
        if (currentStep >= steps.length) {
          clearInterval(animationInterval);
          return;
        }
        applyStep(steps[currentStep]);
        currentStep++;
      }, 800);
    }

    function pauseAnimation() {
      clearInterval(animationInterval);
    }

    function applyStep(stepData) {
      const elements = [...field.children].filter(el => el.classList.contains("player") || el.classList.contains("defender") || el.classList.contains("ball"));
      elements.forEach(el => field.removeChild(el));
      attackers = 0;
      defenders = 0;
      ballExists = false;
      stepData.forEach(data => {
        const el = document.createElement("div");
        el.className = data.class;
        if (data.class.includes("ball")) {
          el.innerHTML = data.html;
          ballExists = true;
        } else {
          el.textContent = data.text;
        }
        el.style.left = data.left;
        el.style.top = data.top;
        if (data.tackle) el.classList.add("tackle");
        makeDraggable(el);
        field.appendChild(el);
        if (data.class.includes("player")) attackers++;
        if (data.class.includes("defender")) defenders++;
      });
    }
  </script>
</body>
</html>